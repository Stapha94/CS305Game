<div class= "header">
 <div class= "container-fluid">
  <h1> Facilitator Home Page </h1>
 </div>
</div>

<div class="panel panel-heading">
  <div class="toolbar">
    <div class= "container-fluid">
      <div class= "row">
        <div class= "col-xs-8">
          <form class="new_student" id="new_student" action="/students" accept-charset="UTF-8" method="post"><input name="utf8" type="hidden" value="✓"><input type="hidden" name="authenticity_token" value="WdrHAIOqw10cmKWaWxv6slN/qFU7C9NZMO3GgTGdddhizGBe+Z9H4q6dA1Q5i1WTmyRuIgTxdBpPO1ILXsg7Sw==">
            <input name="utf8" type="hidden" value="✓">
            <input type="hidden" name="authenticity_token" value="WdrHAIOqw10cmKWaWxv6slN/qFU7C9NZMO3GgTGdddhizGBe+Z9H4q6dA1Q5i1WTmyRuIgTxdBpPO1ILXsg7Sw==">
            <input placeholder="Study ID" style="float: left;" type="text" name="student[sid]" id="student_sid" vk_11b6c="subscribed">
            <button type="submit" name="commit" formaction="/facilitator/add-student" class="btn btn-success" style="float: left;"><span class="glyphicon glyphicon-plus"></span></button>
            <button type="submit" name="commit" formaction="/facilitator/remove-student" class="btn btn-danger" style="float: left;"><span class="glyphicon glyphicon-minus"></span></button>
          </form>
        </div>
        <div class="col-xs-4">
          <div class="search-match" style="float: right;">
            <input id="search-field" name="search-field" type="text" />
            <button class="btn btn-default" name="search-btn" type="button" onclick="search()"><span class="glyphicon glyphicon-search"></span></button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<div id="main-container" class="container">
      <div class="row">
        <div class="col-xs-12">
          <% flash.each do |name, msg| -%>
            <%= content_tag :div, msg, class: "alert alert-#{name}" %>
          <% end -%>
        </div>
      </div>
  </div>


<div class="container-fluid">
 <div class="row">
   <div class= "dropdown">
     <button class="btn btn-primary dropdown-toggle" type="button" data-toggle="dropdown">Sort by...
       <span class="caret"></span></button>
     <ul class="dropdown-menu">
       <li><a data-target="#" href="/facilitator?sortbysid">SID (A-Z) </a></li>
       <li class="divider"></li>
       <li><a data-target="#" href="/facilitator?sortbych1" >Ch1</a></li>
       <li class="divider"></li>
       <li><a data-target="#" href="/facilitator?sortbyreversesid" >SID (Z-A)</a></li>
     </ul>
   </div>
   <div class="radio-inline">
     <label><input id="all" type="radio" name="optradio" value="" onclick="addDanger()">Show All</label>
   </div>
   <div class="radio-inline">
      <label><input id="enrolled" type="radio" name="optradio" value="" checked="checked" onclick="removeDanger()">Only Show Enrolled</label>
   </div>
   </div>
   <div class="col-xs-12">
     <div class="table-responsive">
     <table class="table">
       <tr class="active">
         <td> SID </td>
         <td> Chapter 1 </td>
       </tr>
       <% if request.fullpath == '/facilitator' %>
           <% @students.each do |s| %>
               <% if s.enrolled%>
                   <tr class="success">
                     <td class="sid"><%= s.sid %></td>
                     <td class="ch1"><%= s.ch1 %></td>
                   </tr>
               <% else %>
                   <tr class="danger">
                     <td class="sid"><%= s.sid %></td>
                     <td class="ch1"><%= s.ch1 %></td>
                   </tr>
               <% end %>
           <% end %>
       <% elsif request.fullpath == '/facilitator?sortbysid' %>
           <% @students = Student.order(:sid) %>
            <% @students.each do |s| %>
             <% if s.enrolled%>
             <tr class="success">
               <td class="sid"><%= s.sid %></td>
               <td class="ch1"><%= s.ch1 %></td>
           </tr>
               <% else %>
                <tr class="danger">
               <td class="sid"><%= s.sid %></td>
               <td class="ch1"><%= s.ch1 %></td>
           </tr>
              <% end %>
             <% end %>
       <% elsif request.fullpath == '/facilitator?sortbych1' %>
           <% @students = Student.order(ch1: :desc) %>
           <% @students.each do |s| %>
               <% if s.enrolled%>
                   <tr class="success">
                     <td class="sid"><%= s.sid %></td>
                     <td class="ch1"><%= s.ch1 %></td>
                   </tr>
               <% else %>
                   <tr class="danger">
                     <td class="sid"><%= s.sid %></td>
                     <td class="ch1"><%= s.ch1 %></td>
                   </tr>
               <% end %>
           <% end %>
           <% elsif request.fullpath == '/facilitator?sortbyreversesid' %>
             <% @students = Student.order(sid: :desc) %>
             <% @students.each do |s| %>
                 <% if s.enrolled%>
                     <tr class="success">
                       <td class="sid"><%= s.sid %></td>
                       <td class="ch1"><%= s.ch1 %></td>
                     </tr>
                 <% else %>
                     <tr class="danger">
                       <td class="sid"><%= s.sid %></td>
                       <td class="ch1"><%= s.ch1 %></td>
                     </tr>
                 <% end %>
             <% end %>
       <% end %>
	</table>
     </div>
    </div>
   </div>
   <div class="row">
     <form class="button_to" method="post" action="/facilitator/download-report">
       <button class="btn btn-info" type="submit"><span class="glyphicon glyphicon-download-alt"></span> Download Report</button>
       <input type="hidden" name="authenticity_token" value="TUQRJWGleoQQwOJunqwwWB7HAx3vTHlBYl407LdeTkV2UrZ7G5D+O6LFRKD8PJ951pzFatC23gIdiKBm2AsA1g==">
     </form>
   </div>

<script>
  function removeDanger(){
    $('tr.danger').hide();
    $('#enrolled').attr('checked', true);
    $('#all').attr('checked', false);
    setCookie("checked", true, false);
  }
  function addDanger(){
    $('tr').show();
    $('#all').attr('checked', true);
    $('#enrolled').attr('checked', false);
    setCookie("checked", false, true);
  }

  function search(){
    var $titles = $("tr.active");
    var $rows = $("tr.success");
    var $dangerrows = $("tr.danger");

    var searchInput = $.trim($('#search-field').val().toUpperCase());
    if (searchInput === "" && $("#enrolled").is(":checked")) {
      $titles.show();
      $rows.show();
    }
    else if (searchInput === "" && $("#all").is(":checked")) {
      $titles.show();
      $rows.show();
      $dangerrows.show();
    }
    else if ($("#enrolled").is(":checked")) {
      $rows.hide();
      $rows.has("td.sid:contains(" + searchInput + ")").show();
    }
    else if ($("#all").is(":checked")) {
      $rows.hide();
      $dangerrows.hide();
      $rows.has("td.sid:contains(" + searchInput + ")").show();
      $dangerrows.has("td.sid:contains(" + searchInput + ")").show();
    }
  }

  function setCookie(cname, enr, a){
    var d = new Date();
    d.setTime(d.getTime() + (24*60*60*1000));
    var expires = "expires="+ d.toUTCString();
    var enrolled = enr;
    var all = a;
    if(enrolled) {
      document.cookie = cname + "=enrolled" + "; " + expires;
    }
    else if(all) {
      document.cookie = cname + "=all" + "; " + expires;
    }
  }

  function getCookie(cname){
    var name = cname + "=";
    var ca = document.cookie.split(';');
    for(var i=0; i<ca.length; i++){
      var c = ca[i];
      while (c.charAt(0)==' ') c = c.substring(1);
      if (c.indexOf(name) == 0) return c.substring(name.length, c.length);
    }
    return "";
  }

  function checkCookie(){
    var checked = getCookie("checked");
    if(checked == ""){
      removeDanger();
    }
    else if(checked == "enrolled") {
      removeDanger();
    }
    else if(checked == "all") {
      addDanger();
    }
  }

  window.onload = checkCookie();
</script>